{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "indicator",
  "description": "Technical information that indicates compromise",
  "type": "object",
  "allOf": [
    {
      "$ref": "../common/core.json"
    },
    {
      "properties": {
        "pattern": {
          "$ref": "#/definitions/pattern",
          "description": "The pattern used to identify the presence of this indicator"
        },
        "start_time": {
          "type": "string",
          "format": "date-time",
          "description": "The time at which this indicator should be considered valid. If omitted, unknown."
        },
        "end_time": {
          "type": "string",
          "format": "date-time",
          "description": "The time at which this indicator should no longer be considered valid. If omitted, unknown or ongoing."
        },
        "impact": {
          "$ref": "../common/impact.json",
          "description": "The impact to operations of the TTP(s) that this indicator detects were they to be realized (individually)"
        }
    	}
    }
  ],
  "required": ["pattern"],
  "definitions": {
    "pattern": {
      "title": "pattern",
      "type": "object",
      "properties": {
        "operator": {
          "type": "string",
          "enum": ["AND", "OR"]
        },
        "operands": {
          "type": "array",
          "items": {
            "anyOf": [
              {
                "$ref": "#/definitions/pattern"
              },
              {
                "$ref": "#/definitions/object"
              },
              {
                "$ref": "#/definitions/test_mechanism"
              }
            ]
          }
        }
      },
      "required": ["operator", "operands"]
    },
    "object": {
      "title": "object",
      "type": "object",
      "properties": {
        "condition": {
          "type": "string",
          "enum": ["equals", "pattern_match"],
          "description": "Describes the type of match. If 'equals', the object should be matched exactly. If 'pattern_match', each field in the object should have a pattern match applied"
        },
        "object_ref": {
          "type": "string",
          "description": "Reference to the object that this matches against."
        }
      },
      "required": ["condition", "object_ref"]
    },
    "test_mechanism": {
      "title": "test-mechanism",
      "type": "object",
      "properties": {
        "_type": {
          "type": "string",
          "description": "The type of test mechanism."
        }
      }
    }
  },
  "relationships": {
    "indicated": ["malware", "attack-pattern", "exploit", "victim-targeting", "tool", "infrastructure", "persona", "campaign", "threat-actor"],
    "suggested": ["course-of-action"],
    "kill-chain-phase": ["kill-chain-phase"],
    "related": ["indicator"],
    "duplicate-of": ["indicator"]
  }
}
